# 프로젝트 계획서: "너 왜 안 와?" (지하철 실시간 지연 분석)

## 1. 프로젝트 개요
실시간 지하철 위치 정보와 공공데이터 시간표를 비교하여, 실제 사용자가 체감하는 **'초과 대기 시간'**과 **'호선별 지연 지수'**를 산출합니다.

## 2. 데이터 거버넌스
*   **수집 공간**: Airflow를 통한 실시간 수집 (`final_realtime_subway` 테이블)
*   **가공 공간**: **Supabase PostgreSQL (View)**
    *   성능과 효율을 위해 DB 내에서 1차 요약 가공을 수행합니다.
*   **분석 공간**: **Python (Pandas)**
    *   엑셀 시간표와 DB의 요약표를 결합하여 최종 지연 시간을 계산합니다.

## 3. 분석 데이터 프레임워크 (가공 열 구성)
최종적으로 생성될 분석용 데이터 세트의 구성 요소입니다.

| 구분 | 변수명 | 설명 | 가공 로직 |
| :--- | :--- | :--- | :--- |
| **기존** | `line_name` | 호선 명칭 | 원본 유지 |
| **기존** | `station_name` | 역 명칭 | 원본 유지 |
| **기존** | `up_down` | 상하행 구분 | 원본 유지 (시간표 매칭 필수값) |
| **신규** | `created_date` | 수집 일자 | `DATE(created_at)` |
| **신규** | `train_code_num` | 숫자 열차번호 | `regexp_replace` (숫자만 추출) |
| **신규** | **`actual_arrival`** | **실제 도착시각** | `MIN(time)` where status in (0,1) |
| **신규** | **`actual_departure`** | **실제 출발시각** | `MIN(time)` where status = 2 |

## 4. 향후 일정
1.  **[D-Day]**: 내일 오전(06~10시) 실시간 데이터 집중 수집.
2.  **데이터 결합**: Python을 활용해 위 요약표와 사용자 제공 엑셀 시간표 조인.
3.  **지연 지수 산출**: `실제 - 계획` 시간을 계산하여 '지연 랭킹' 시각화.
